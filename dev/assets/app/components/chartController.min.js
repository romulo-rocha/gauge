!function(t,n){"use strict";t.controller("ChartController",["$http","$log","$timeout","$window","$scope",function(t,r,e,s,a){var i=this,o=0,c={};i.brands=null,i.users=null,i.interactions=null,i.allDataLoaded=!1,i.user=null,i.currentBrand="all";var u=function(){var t=[],n=[],r=[],e=[],s=0;for(s=0;s<i.brands.length;s+=1)t.push(i.brands[s].name),n.push(i.user.interactions[i.brands[s].id].SHARE),r.push(i.user.interactions[i.brands[s].id].COMMENT),e.push(i.user.interactions[i.brands[s].id].FAVORITE);c={chart:{type:"column"},title:{text:"Interactions by "+i.user.login.username},subtitle:{text:"Interactions per brand"},xAxis:{categories:t,crosshair:!0},yAxis:{min:0,title:{text:"Interactions"}},tooltip:{headerFormat:'<span style="font-size:10px">{point.key}</span><table>',pointFormat:'<tr><td style="color:{series.color};padding:0">{series.name}: </td><td style="padding:0"><b>{point.y}</b></td></tr>',footerFormat:"</table>",shared:!0,useHTML:!0},plotOptions:{column:{pointPadding:.2,borderWidth:0}},series:[{name:"Share",data:n},{name:"Comment",data:r},{name:"Favorite",data:e}]}},l=function(){var t=0,n=0,r=0,e=0;for(t=0;t<i.users.length;t+=1){for(i.users[t].interactions={},e=0,r=0;r<i.brands.length;r+=1)i.users[t].interactions[i.brands[r].id]={brand_name:i.brands[r].name,totalInteractions:0,SHARE:0,COMMENT:0,FAVORITE:0,brand_image:i.brands[r].image};for(n=0;n<i.interactions.length;n+=1)i.interactions[n].user===i.users[t].id&&(i.users[t].interactions[i.interactions[n].brand].totalInteractions+=1,i.users[t].interactions[i.interactions[n].brand][i.interactions[n].type]+=1,e+=1);i.users[t].totalInteractions=e}null!==i.user&&u(),i.allDataLoaded=!0},d=function(){o+=1,o>=3&&l()};t.get("data/brands.json").success(function(t){i.brands=t,d()}),t.get("data/users.json").success(function(t){i.users=t,d()}),t.get("data/interactions.json").success(function(t){i.interactions=t,d()}),i.setCurrentUserID=function(t){var s=0;for(s=0;s<i.users.length;s+=1)if(i.users[s].id===t){i.user=i.users[s],u(),e(function(){n("#interaction-chart").highcharts(c)}),r.log(i.user);break}},a.brandFilter=function(){return function(t){return"all"===i.currentBrand?t.totalInteractions>0:t.interactions[parseInt(i.currentBrand)].totalInteractions>0}},a.brandSort=function(t){return"all"===i.currentBrand?t.totalInteractions:t.interactions[parseInt(i.currentBrand)].totalInteractions},n(s).resize(function(){null!==i.user&&n("#interaction-chart").highcharts(c)})}])}(this.GAUGE,this.jQuery);